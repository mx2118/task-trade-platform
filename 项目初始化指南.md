# 任务平台项目初始化指南

## 1. 环境准备

### 1.1 开发环境要求
- **Go**: 1.21+
- **Node.js**: 18+
- **MySQL**: 8.0+
- **Redis**: 6.0+
- **RabbitMQ**: 3.8+

### 1.2 开发工具推荐
- **IDE**: GoLand / VS Code
- **API测试**: Postman / Insomnia
- **数据库管理**: Navicat / DataGrip
- **版本控制**: Git

## 2. 后端项目初始化

### 2.1 创建项目结构
```bash
# 创建项目目录
mkdir task-platform-api
cd task-platform-api

# 初始化Go模块
go mod init task-platform-api

# 创建目录结构
mkdir -p {cmd/server,internal/{api/{v1/{handlers,middleware,routes,validators},docs},config,models,repository/{interfaces,mysql,redis},service/{interfaces},pkg/{utils,logger,errors,queue},domain/{user,task,order}},pkg/{config,database,middleware,validator},scripts,configs,docs,deployments/{docker,kubernetes,nginx},tests/{integration,unit,mock}}
```

### 2.2 安装依赖
```bash
# 核心依赖
go get github.com/gin-gonic/gin
go get github.com/golang-jwt/jwt/v5
go get github.com/spf13/viper
go get github.com/go-redis/redis/v8
go get gorm.io/gorm
go get gorm.io/driver/mysql
go get github.com/streadway/amqp

# 工具依赖
go get github.com/sirupsen/logrus
go get github.com/go-playground/validator/v10
go get github.com/swaggo/gin-swagger
go get github.com/swaggo/swag
go get golang.org/x/crypto
go get github.com/google/uuid
go get github.com/robfig/cron/v3

# 开发依赖
go get github.com/golang/mock
go get github.com/stretchr/testify
```

### 2.3 配置文件创建

#### configs/config.yaml
```yaml
server:
  port: "8080"
  mode: "debug"  # debug, release
  read_timeout: 30
  write_timeout: 30

database:
  host: "localhost"
  port: 3306
  username: "root"
  password: "password"
  database: "task_platform"
  max_idle_conn: 10
  max_open_conn: 100

redis:
  host: "localhost"
  port: 6379
  password: ""
  db: 0

jwt:
  secret: "your-secret-key-here"
  expire_time: 86400  # 24小时

log:
  level: "info"
  format: "json"
  output: "stdout"

oss:
  endpoint: "https://oss-cn-hangzhou.aliyuncs.com"
  access_key_id: "your-access-key-id"
  access_key_secret: "your-access-key-secret"
  bucket: "task-platform"

sms:
  provider: "aliyun"
  api_key: "your-api-key"
  secret: "your-secret"

email:
  host: "smtp.example.com"
  port: 587
  username: "noreply@example.com"
  password: "your-password"
  from: "任务平台 <noreply@example.com>"
```

### 2.4 数据库初始化

#### scripts/init.sql
```sql
-- 创建数据库
CREATE DATABASE IF NOT EXISTS task_platform CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

USE task_platform;

-- 用户表
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户名',
    phone VARCHAR(20) UNIQUE COMMENT '手机号',
    email VARCHAR(100) UNIQUE COMMENT '邮箱',
    password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
    nickname VARCHAR(50) NOT NULL COMMENT '昵称',
    avatar VARCHAR(255) COMMENT '头像URL',
    gender TINYINT DEFAULT 0 COMMENT '性别:0-未知,1-男,2-女',
    bio TEXT COMMENT '个人简介',
    status TINYINT DEFAULT 1 COMMENT '状态:0-禁用,1-正常,2-待审核',
    credit_score DECIMAL(3,1) DEFAULT 5.0 COMMENT '信用评分(0-10)',
    level INT DEFAULT 1 COMMENT '用户等级',
    role ENUM('user', 'admin') DEFAULT 'user' COMMENT '角色',
    device_token VARCHAR(255) COMMENT '设备推送令牌',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    INDEX idx_username (username),
    INDEX idx_phone (phone),
    INDEX idx_email (email),
    INDEX idx_status (status),
    INDEX idx_role (role)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';

-- 任务分类表
CREATE TABLE task_categories (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL COMMENT '分类名称',
    icon VARCHAR(255) COMMENT '图标URL',
    description TEXT COMMENT '分类描述',
    sort_order INT DEFAULT 0 COMMENT '排序权重',
    status TINYINT DEFAULT 1 COMMENT '状态:0-禁用,1-启用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_sort_order (sort_order),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='任务分类表';

-- 任务表
CREATE TABLE tasks (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    publisher_id BIGINT NOT NULL COMMENT '发布者ID',
    category_id BIGINT NOT NULL COMMENT '分类ID',
    title VARCHAR(200) NOT NULL COMMENT '任务标题',
    description TEXT NOT NULL COMMENT '任务描述',
    budget DECIMAL(10,2) NOT NULL COMMENT '预算金额',
    budget_type ENUM('fixed', 'bid') NOT NULL COMMENT '预算类型:fixed-固定,bid-竞价',
    deadline TIMESTAMP NOT NULL COMMENT '截止时间',
    location VARCHAR(200) COMMENT '工作地点',
    worker_count INT DEFAULT 1 COMMENT '需要人数',
    current_count INT DEFAULT 0 COMMENT '当前接单人数',
    status TINYINT DEFAULT 0 COMMENT '状态:0-草稿,1-待接单,2-进行中,3-已完成,4-已取消',
    requirements TEXT COMMENT '具体要求',
    attachments JSON COMMENT '附件',
    tags JSON COMMENT '标签',
    views INT DEFAULT 0 COMMENT '浏览次数',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    INDEX idx_publisher_id (publisher_id),
    INDEX idx_category_id (category_id),
    INDEX idx_status (status),
    INDEX idx_deadline (deadline),
    INDEX idx_created_at (created_at),
    INDEX idx_title_desc (title, description(100)),
    FOREIGN KEY (publisher_id) REFERENCES users(id),
    FOREIGN KEY (category_id) REFERENCES task_categories(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='任务表';

-- 插入初始分类数据
INSERT INTO task_categories (name, description, sort_order) VALUES
('技术开发', '软件开发、网站建设、APP开发等', 1),
('设计创意', 'UI设计、平面设计、logo设计等', 2),
('文案写作', '文案策划、内容创作、翻译等', 3),
('营销推广', '网络营销、SEO优化、社媒运营等', 4),
('生活服务', '家政服务、跑腿代办、维修等', 5),
('教育培训', '在线辅导、技能培训、咨询服务等', 6);
```

### 2.5 迁移脚本

#### scripts/migrate.go
```go
package main

import (
    "log"
    "task-platform-api/internal/config"
    "task-platform-api/pkg/database"
    "task-platform-api/internal/models"
)

func main() {
    // 加载配置
    cfg, err := config.Load()
    if err != nil {
        log.Fatal("Failed to load config:", err)
    }

    // 连接数据库
    db, err := database.InitMySQL(cfg.Database)
    if err != nil {
        log.Fatal("Failed to connect to database:", err)
    }

    // 自动迁移
    err = db.AutoMigrate(
        &models.User{},
        &models.UserProfile{},
        &models.UserSkill{},
        &models.TaskCategory{},
        &models.Task{},
        &models.TaskApplication{},
        &models.TaskTag{},
        &models.Order{},
        &models.Payment{},
        &models.Review{},
        &models.Complaint{},
        &models.Message{},
        &models.Notification{},
        &models.Wallet{},
        &models.WalletTransaction{},
        &models.WithdrawRequest{},
    )

    if err != nil {
        log.Fatal("Failed to migrate database:", err)
    }

    log.Println("Database migration completed successfully!")
}
```

## 3. 前端项目初始化

### 3.1 创建Vue项目
```bash
# 使用Vite创建Vue3项目
npm create vite@latest task-platform-frontend -- --template vue-ts
cd task-platform-frontend

# 安装依赖
npm install

# 安装UI库和工具
npm install element-plus @element-plus/icons-vue
npm install pinia vue-router@4
npm install axios dayjs lodash-es js-cookie
npm install @vueuse/core
npm install echarts vue-echarts
npm install swiper
npm install qrcode

# 安装开发依赖
npm install -D @types/node @types/lodash-es @types/js-cookie
npm install -D sass unplugin-auto-import unplugin-vue-components
npm install -D @typescript-eslint/eslint-plugin @typescript-eslint/parser
npm install -D @vue/eslint-config-prettier @vue/eslint-config-typescript
npm install -D prettier eslint-plugin-vue
npm install -D vitest @vitest/ui
npm install -D cypress
```

### 3.2 创建目录结构
```bash
# 创建项目目录
mkdir -p src/{api,assets/{images,icons,styles},components/{common,forms,cards,business},composables,layouts,pages/{auth,home,tasks,user,orders,payment,reviews,messages,admin},router,stores,utils,directives,plugins,types}
mkdir -p tests/{unit,e2e,fixtures}
```

### 3.3 环境变量配置

#### .env.development
```env
VITE_APP_TITLE=任务平台
VITE_API_BASE_URL=http://localhost:8080/api/v1
VITE_UPLOAD_URL=http://localhost:8080/api/v1/upload
VITE_WS_URL=ws://localhost:8080/ws
```

#### .env.production
```env
VITE_APP_TITLE=任务平台
VITE_API_BASE_URL=https://api.taskplatform.com/api/v1
VITE_UPLOAD_URL=https://api.taskplatform.com/api/v1/upload
VITE_WS_URL=wss://api.taskplatform.com/ws
```

### 3.4 样式文件创建

#### src/assets/styles/variables.scss
```scss
// 主题色
$primary-color: #409eff;
$success-color: #67c23a;
$warning-color: #e6a23c;
$danger-color: #f56c6c;
$info-color: #909399;

// 文字色
$text-primary: #303133;
$text-regular: #606266;
$text-secondary: #909399;
$text-placeholder: #c0c4cc;

// 边框色
$border-color: #dcdfe6;
$border-light: #e4e7ed;
$border-lighter: #ebeef5;

// 背景色
$bg-color: #f5f7fa;
$bg-white: #ffffff;

// 间距
$spacing-xs: 4px;
$spacing-sm: 8px;
$spacing-md: 16px;
$spacing-lg: 24px;
$spacing-xl: 32px;

// 断点
$breakpoint-xs: 480px;
$breakpoint-sm: 768px;
$breakpoint-md: 992px;
$breakpoint-lg: 1200px;
$breakpoint-xl: 1920px;
```

## 4. Docker配置

### 4.1 后端Dockerfile

#### deployments/docker/Dockerfile.api
```dockerfile
FROM golang:1.21-alpine AS builder

WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -o main cmd/server/main.go

FROM alpine:latest
RUN apk --no-cache add ca-certificates tzdata
WORKDIR /root/
COPY --from=builder /app/main .
COPY --from=builder /app/configs ./configs

EXPOSE 8080
CMD ["./main"]
```

### 4.2 前端Dockerfile

#### deployments/docker/Dockerfile.frontend
```dockerfile
FROM node:18-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY deployments/nginx/nginx.conf /etc/nginx/nginx.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### 4.3 Docker Compose

#### docker-compose.yml
```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: task-platform-mysql
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: task_platform
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./scripts/init.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - task-platform

  redis:
    image: redis:6-alpine
    container_name: task-platform-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - task-platform

  rabbitmq:
    image: rabbitmq:3-management
    container_name: task-platform-rabbitmq
    environment:
      RABBITMQ_DEFAULT_USER: admin
      RABBITMQ_DEFAULT_PASS: password
    ports:
      - "5672:5672"
      - "15672:15672"
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq
    networks:
      - task-platform

  api:
    build:
      context: ./task-platform-api
      dockerfile: ../deployments/docker/Dockerfile.api
    container_name: task-platform-api
    ports:
      - "8080:8080"
    depends_on:
      - mysql
      - redis
      - rabbitmq
    environment:
      - GIN_MODE=release
    volumes:
      - ./configs:/root/configs
    networks:
      - task-platform

  frontend:
    build:
      context: ./task-platform-frontend
      dockerfile: ../deployments/docker/Dockerfile.frontend
    container_name: task-platform-frontend
    ports:
      - "80:80"
    depends_on:
      - api
    networks:
      - task-platform

volumes:
  mysql_data:
  redis_data:
  rabbitmq_data:

networks:
  task-platform:
    driver: bridge
```

## 5. 开发启动流程

### 5.1 后端启动
```bash
# 进入后端目录
cd task-platform-api

# 安装依赖
go mod tidy

# 运行迁移
go run scripts/migrate.go

# 启动开发服务器
go run cmd/server/main.go
```

### 5.2 前端启动
```bash
# 进入前端目录
cd task-platform-frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 5.3 Docker启动
```bash
# 启动所有服务
docker-compose up -d

# 查看日志
docker-compose logs -f

# 停止服务
docker-compose down
```

## 6. 开发规范

### 6.1 Git工作流
```bash
# 功能分支开发
git checkout -b feature/user-auth

# 提交规范
git commit -m "feat: 添加用户认证功能"
git commit -m "fix: 修复任务列表分页bug"
git commit -m "docs: 更新API文档"
```

### 6.2 代码规范
- Go: 使用gofmt格式化代码
- Vue: 使用ESLint + Prettier
- 提交信息: 遵循Conventional Commits规范

### 6.3 测试要求
- 单元测试覆盖率 > 80%
- API接口必须编写测试
- 前端组件需要单元测试

## 7. 部署准备

### 7.1 服务器要求
- CPU: 2核+
- 内存: 4GB+
- 硬盘: 50GB+
- 操作系统: Ubuntu 20.04 LTS

### 7.2 域名和SSL
- 配置域名解析
- 申请SSL证书
- 配置HTTPS

### 7.3 监控配置
- 应用监控
- 服务器监控
- 日志收集
- 性能监控

这份初始化指南提供了完整的项目搭建流程，帮助快速启动任务平台的开发工作。
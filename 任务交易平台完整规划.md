# 任务交易平台系统完整规划（Go+Vue3.5技术栈）

## 一、系统核心定位与技术选型

### （一）核心定位

基于优化后规则，构建一款"轻量准入、安全可控、流程清晰"的任务交易平台，支持用户微信/支付宝授权登录，实现任务发布、接取、验收、结算全流程线上化，同时通过信誉体系、风控机制保障三方权益，为后续规模化运营预留扩展接口。

### （二）技术栈选型

#### 1. 后端技术栈（Go）

- **核心框架**：Gin（高性能HTTP web框架，支持中间件、路由分组，适配API快速开发）
- **ORM工具**：GORM（支持多数据库适配，简化数据CRUD，适配事务管理需求，如资金结算、任务状态变更）
- **数据库**：MySQL 8.0（主库存储用户信息、任务数据、交易记录等核心业务数据，支持事务一致性）+ Redis（缓存用户会话、任务列表、高频查询数据，提升响应速度）
- **支付与授权**：对接收钱吧开放平台API（含RESTful接口及SDK），实现资金预缴、结算划转、退款、交易查询等全流程支付功能；用户授权登录仍保留微信/支付宝渠道，仅支付环节通过收钱吧闭环处理，接入收钱吧资金监管账户，保障资金合规与流转透明
- **风控与安全**：JWT生成用户身份令牌，实现无状态认证；IP/设备指纹识别（基于golang.org/x/net/ipv4包）；数据加密采用AES-256，敏感信息（如用户手机号、支付凭证）加密存储
- **消息通知**：集成微信公众号模板消息/支付宝生活号通知，实现结算提醒、任务状态变更、申诉结果等消息推送
- **日志与监控**：Zap日志框架（结构化日志，便于问题排查）；Prometheus+Grafana（监控系统性能、接口响应时长、异常交易指标）

#### 2. 前端技术栈（Vue3.5）

- **核心框架**：Vue3.5 + Vite（Vite提升开发构建速度，适配Vue3组合式API，简化组件逻辑）
- **UI组件库**：Element Plus（适配Vue3，提供表单、弹窗、表格等基础组件，满足任务发布、验收、个人中心等页面需求）
- **状态管理**：Pinia（替代Vuex，轻量易用，管理用户会话、任务状态、全局通知等共享数据）
- **路由管理**：Vue Router 4（实现页面路由跳转、权限控制，如未登录用户拦截至授权页面）
- **网络请求**：Axios（封装请求拦截器、响应拦截器，统一处理接口授权、异常提示，适配后端API规范）
- **支付对接**：集成收钱吧H5支付SDK及JSAPI，实现前端支付唤起、支付结果同步回调、订单状态轮询；适配收钱吧多支付渠道（微信、支付宝、银联）展示，统一支付交互体验
- **其他工具**：Vue-i18n（可选，支持多语言）；ECharts（个人中心数据可视化，如交易明细、信誉评分趋势）

#### 3. 部署与运维

- **部署方式**：Docker容器化部署（后端、前端、数据库分别容器化，便于环境一致性管理）；Docker Compose本地调试，K8s集群用于生产环境规模化部署
- **CI/CD**：GitLab CI/GitHub Actions（自动化构建、测试、部署，提升开发效率）
- **域名与HTTPS**：配置域名，通过Let's Encrypt申请免费SSL证书，强制HTTPS访问，保障数据传输安全

## 二、系统架构设计

### （一）整体架构（分层架构）

#### 1. 前端层
负责用户交互界面渲染、前端表单验证、支付唤起、消息展示等，通过Axios与后端API通信，遵循RESTful接口规范。

#### 2. 网关层
Nginx作为反向代理，转发前端请求至后端服务，同时实现负载均衡、静态资源缓存、接口限流（防止恶意请求）。

#### 3. 应用层（Go后端）
核心业务逻辑层，按模块拆分服务，通过Gin提供API接口，包含用户模块、任务模块、支付结算模块、风控模块、信誉模块等。

#### 4. 数据层
MySQL存储核心业务数据，Redis缓存高频数据，同时对接第三方支付监管账户，实现资金数据同步。

#### 5. 第三方服务层
收钱吧开放平台（核心支付服务）、微信/支付宝开放平台（仅用于用户授权登录）、第三方支付监管机构、短信/消息推送服务等，为系统提供扩展能力。

### （二）核心模块拆分（后端）

#### 1. 用户模块（User Module）

**核心功能**：
- 微信/支付宝授权登录（获取用户唯一标识，加密存储）
- 用户信息管理（个人中心数据、信誉等级展示）
- 账号注销与资金清退
- 会话管理（JWT令牌生成、刷新、失效）

**关键接口**：
- `/api/v1/user/auth`（授权登录）
- `/api/v1/user/info`（获取用户信息）
- `/api/v1/user/logout`（退出登录）
- `/api/v1/user/cancel`（账号注销）

**数据模型**：
```sql
-- 用户表
CREATE TABLE users (
    user_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    openid VARCHAR(128) COMMENT '微信/支付宝用户标识',
    unionid VARCHAR(128) COMMENT '跨平台用户标识',
    auth_type ENUM('wechat', 'alipay') NOT NULL COMMENT '授权类型',
    credit_score DECIMAL(3,1) DEFAULT 5.0 COMMENT '信用评分(0-10)',
    level INT DEFAULT 1 COMMENT '用户等级',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_openid (openid),
    INDEX idx_unionid (unionid)
) ENGINE=InnoDB COMMENT='用户表';

-- 用户会话表
CREATE TABLE user_sessions (
    session_id VARCHAR(64) PRIMARY KEY,
    user_id BIGINT NOT NULL,
    token VARCHAR(512) NOT NULL,
    expire_time TIMESTAMP NOT NULL,
    device_info VARCHAR(255) COMMENT '设备信息',
    ip_address VARCHAR(45) COMMENT 'IP地址',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_token (token)
) ENGINE=InnoDB COMMENT='用户会话表';
```

#### 2. 任务模块（Task Module）

**核心功能**：
- 任务发布（信息校验、预缴资金校验）
- 任务审核（系统自动违禁词过滤、内容合规性校验）
- 任务接取（权限校验、保证金+服务费预缴）
- 任务交付（成果上传、凭证标准化）
- 任务验收（分阶段验收、自动超时处理）
- 任务变更（协议签订、金额调整）

**关键接口**：
- `/api/v1/task/publish`（发布任务）
- `/api/v1/task/audit`（任务审核结果查询）
- `/api/v1/task/take`（接取任务）
- `/api/v1/task/deliver`（交付成果）
- `/api/v1/task/accept`（验收成果）
- `/api/v1/task/modify`（变更任务）

**数据模型**：
```sql
-- 任务表
CREATE TABLE tasks (
    task_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    publisher_id BIGINT NOT NULL COMMENT '发布者ID',
    taker_id BIGINT COMMENT '接取者ID',
    title VARCHAR(200) NOT NULL COMMENT '任务标题',
    content TEXT NOT NULL COMMENT '任务内容',
    amount DECIMAL(10,2) NOT NULL COMMENT '任务金额',
    service_fee_ratio DECIMAL(3,2) DEFAULT 0.06 COMMENT '服务费比例',
    deposit_ratio DECIMAL(3,2) DEFAULT 0.10 COMMENT '保证金比例',
    deadline TIMESTAMP NOT NULL COMMENT '截止时间',
    status TINYINT DEFAULT 0 COMMENT '状态:0-草稿,1-待接取,2-进行中,3-待验收,4-已完成,5-已取消',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_publisher_id (publisher_id),
    INDEX idx_taker_id (taker_id),
    INDEX idx_status (status),
    INDEX idx_deadline (deadline)
) ENGINE=InnoDB COMMENT='任务表';

-- 任务阶段表
CREATE TABLE task_stages (
    stage_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    task_id BIGINT NOT NULL,
    stage_name VARCHAR(100) NOT NULL COMMENT '阶段名称',
    amount_ratio DECIMAL(3,2) NOT NULL COMMENT '阶段金额比例',
    deadline TIMESTAMP COMMENT '阶段截止时间',
    status TINYINT DEFAULT 0 COMMENT '状态:0-待开始,1-进行中,2-已完成',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_task_id (task_id)
) ENGINE=InnoDB COMMENT='任务阶段表';

-- 交付凭证表
CREATE TABLE task_deliveries (
    delivery_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    task_id BIGINT NOT NULL,
    taker_id BIGINT NOT NULL,
    file_url VARCHAR(500) COMMENT '文件URL',
    content TEXT COMMENT '交付说明',
    status TINYINT DEFAULT 0 COMMENT '状态:0-待验收,1-已验收,2-需整改',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_task_id (task_id),
    INDEX idx_taker_id (taker_id)
) ENGINE=InnoDB COMMENT='交付凭证表';
```

#### 3. 支付结算模块（Payment Module）

**核心功能**：
- 资金预缴（发布方本金+服务费、接取方保证金+服务费），通过收钱吧API生成预支付订单
- 支付回调处理（校验收钱吧签名、同步订单状态至系统，更新任务状态）
- 资金结算（验收通过后，调用收钱吧转账接口划转本金、保证金）
- 退款处理（审核驳回、未接取任务时，通过收钱吧退款接口原路退回资金）
- 违约金划转（违约判定后，结合收钱吧交易明细完成资金扣减与赔付）
- 交易明细同步（实时拉取收钱吧交易凭证，生成系统内交易记录）

**关键接口**：
- `/api/v1/pay/prepay`（生成收钱吧预支付订单）
- `/api/v1/pay/callback`（接收收钱吧支付结果回调）
- `/api/v1/pay/settle`（调用收钱吧接口完成资金结算）
- `/api/v1/pay/refund`（发起收钱吧退款申请）
- `/api/v1/pay/detail`（同步收钱吧交易明细）
- `/api/v1/pay/query`（查询收钱吧订单状态）

**数据模型**：
```sql
-- 交易表
CREATE TABLE trades (
    trade_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    task_id BIGINT COMMENT '关联任务ID',
    trade_type ENUM('prepay', 'settle', 'refund', 'penalty') NOT NULL COMMENT '交易类型',
    amount DECIMAL(10,2) NOT NULL COMMENT '交易金额',
    third_party_no VARCHAR(64) COMMENT '第三方交易号',
    status TINYINT DEFAULT 0 COMMENT '状态:0-待支付,1-已支付,2-已失败',
    pay_time TIMESTAMP COMMENT '支付时间',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_task_id (task_id),
    INDEX idx_third_party_no (third_party_no)
) ENGINE=InnoDB COMMENT='交易表';

-- 结算表
CREATE TABLE settlements (
    settle_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    task_id BIGINT NOT NULL,
    publisher_amount DECIMAL(10,2) NOT NULL COMMENT '发布方收入',
    taker_amount DECIMAL(10,2) NOT NULL COMMENT '接取方收入',
    platform_fee DECIMAL(10,2) NOT NULL COMMENT '平台费用',
    penalty DECIMAL(10,2) DEFAULT 0 COMMENT '违约金',
    settle_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_task_id (task_id)
) ENGINE=InnoDB COMMENT='结算表';

-- 退款表
CREATE TABLE refunds (
    refund_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    trade_id BIGINT NOT NULL,
    refund_amount DECIMAL(10,2) NOT NULL COMMENT '退款金额',
    reason VARCHAR(500) COMMENT '退款原因',
    status TINYINT DEFAULT 0 COMMENT '状态:0-处理中,1-已成功,2-已失败',
    refund_time TIMESTAMP COMMENT '退款时间',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_trade_id (trade_id)
) ENGINE=InnoDB COMMENT='退款表';
```

#### 4. 风控与信誉模块（Risk & Credit Module）

**核心功能**：
- 异常交易监测（高频交易、反复发布/撤销预警）
- 多账号校验（IP+设备+账号三重校验）
- 信誉等级评定（指标打分、等级更新）
- 信誉权益适配（保证金梯度、服务费折扣）
- 违规处罚（账户冻结、权限限制）
- 申诉处理（分级审核、结果推送）

**关键接口**：
- `/api/v1/risk/monitor`（异常交易预警）
- `/api/v1/credit/grade`（查询信誉等级）
- `/api/v1/credit/update`（更新信誉评分）
- `/api/v1/complaint/submit`（提交申诉）
- `/api/v1/complaint/result`（查询申诉结果）

**数据模型**：
```sql
-- 信誉表
CREATE TABLE user_credits (
    credit_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    score DECIMAL(3,1) DEFAULT 5.0 COMMENT '信用评分',
    level INT DEFAULT 1 COMMENT '信用等级',
    complete_rate DECIMAL(3,2) DEFAULT 0.00 COMMENT '任务完成率',
    accept_rate DECIMAL(3,2) DEFAULT 0.00 COMMENT '任务接取率',
    violate_count INT DEFAULT 0 COMMENT '违规次数',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_user_id (user_id)
) ENGINE=InnoDB COMMENT='信誉表';

-- 违规表
CREATE TABLE violations (
    violate_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    task_id BIGINT COMMENT '关联任务ID',
    violate_type ENUM('fraud', 'delay', 'quality', 'other') NOT NULL COMMENT '违规类型',
    penalty DECIMAL(10,2) DEFAULT 0 COMMENT '处罚金额',
    handle_time TIMESTAMP COMMENT '处理时间',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_task_id (task_id)
) ENGINE=InnoDB COMMENT='违规表';

-- 申诉表
CREATE TABLE complaints (
    complaint_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    task_id BIGINT COMMENT '关联任务ID',
    content TEXT NOT NULL COMMENT '申诉内容',
    evidence JSON COMMENT '申诉证据',
    status TINYINT DEFAULT 0 COMMENT '状态:0-待处理,1-处理中,2-已解决,3-已驳回',
    result TEXT COMMENT '处理结果',
    handle_time TIMESTAMP COMMENT '处理时间',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_task_id (task_id)
) ENGINE=InnoDB COMMENT='申诉表';
```

#### 5. 消息通知模块（Notification Module）

**核心功能**：
- 任务状态变更通知（发布、接取、验收、违约）
- 支付结算通知（预缴成功、结算到账、退款到账）
- 申诉结果通知
- 系统公告推送

**关键接口**：
- `/api/v1/notify/list`（查询通知列表）
- `/api/v1/notify/read`（标记已读）

**数据模型**：
```sql
-- 通知表
CREATE TABLE notifications (
    notify_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    title VARCHAR(200) NOT NULL COMMENT '通知标题',
    content TEXT NOT NULL COMMENT '通知内容',
    type ENUM('task', 'payment', 'complaint', 'system') NOT NULL COMMENT '通知类型',
    is_read TINYINT DEFAULT 0 COMMENT '是否已读:0-未读,1-已读',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_type (type),
    INDEX idx_is_read (is_read)
) ENGINE=InnoDB COMMENT='通知表';
```

## 三、前端页面规划（Vue3.5）

### （一）页面结构

#### 1. 公共页面
- 登录授权页（微信/支付宝授权入口）
- 首页（任务列表、分类筛选、热门任务推荐）
- 系统公告页
- 帮助中心（规则说明）

#### 2. 用户中心
- 个人主页（信誉等级、评分明细）
- 交易明细页（收支记录、结算详情）
- 任务管理页（我发布的、我接取的、待验收、待交付）
- 消息中心
- 账号设置（绑定信息、注销账号）

#### 3. 任务操作页面
- 任务发布页（表单填写、金额计算、支付预缴）
- 任务详情页（任务信息、接取按钮、信誉筛选）
- 成果交付页（模板选择、文件上传、提交凭证）
- 验收页（成果查看、验收操作、整改意见填写）
- 申诉页（内容编辑、证据上传）

#### 4. 支付相关页面
- 支付确认页（金额明细、支付方式选择）
- 支付结果页（成功/失败提示、后续操作引导）
- 退款申请页

### （二）核心页面交互逻辑

#### 任务发布流程：
用户填写任务信息 → 前端校验（必填项、金额合规性） → 计算预缴金额（本金+6%服务费） → 调用后端预缴接口（生成收钱吧预支付订单） → 唤起收钱吧支付页面（展示微信、支付宝等渠道） → 支付成功后接收收钱吧回调通知 → 跳转至审核结果页，等待系统审核

#### 任务接取流程：
用户查看任务详情 → 前端校验（信誉等级是否达标、是否已预缴对应费用） → 计算预缴金额（10%保证金+8%服务费） → 调用后端接取接口（生成收钱吧预支付订单） → 唤起收钱吧支付页面完成支付 → 接收收钱吧回调确认支付成功 → 任务状态更新为"待交付"

#### 验收结算流程：
接取方提交交付成果 → 发布方收到通知 → 24小时内完成验收（普通任务）/ 阶段验收（复杂任务） → 验收通过后，前端实时展示结算状态 → 收到结算到账通知，跳转至交易明细页

## 四、开发与上线规划

### （一）开发周期规划（总周期12周）

#### 1. 需求梳理与架构设计阶段（第1-2周）
细化接口文档、数据模型设计、前端原型设计、技术方案评审，输出接口文档、数据库表结构、原型图

#### 2. 基础开发阶段（第3-6周）
**后端**：
- 搭建Gin项目框架
- 实现数据库连接
- 开发用户模块
- 任务模块基础接口
- 支付对接核心功能

**前端**：
- 搭建Vue3.5+Vite项目
- 封装Axios请求
- 开发公共组件
- 实现登录页、首页、个人中心基础页面

#### 3. 核心功能开发阶段（第7-9周）
**后端**：
- 开发结算模块
- 风控模块
- 信誉模块
- 消息通知模块
- 完善接口逻辑，实现异常处理、事务控制

**前端**：
- 开发任务发布、接取、交付、验收页面
- 集成支付功能
- 实现状态管理、路由权限控制
- 适配后端接口

#### 4. 测试与优化阶段（第10-11周）
**功能测试**：
- 全流程场景测试（发布-接取-交付-验收-结算）
- 异常场景测试（违约、退款、申诉）

**性能测试**：
- 接口响应速度、并发量测试（如同时发布/接取任务）
- Redis缓存优化

**Bug修复与优化**：
- 根据测试结果修复问题
- 优化前端交互、后端接口性能
- 完善日志与监控

#### 5. 灰度上线与正式上线（第12周）
**灰度上线**：
- 邀请小范围用户测试（50-100人）
- 收集反馈，微调功能

**正式上线**：
- 部署生产环境
- 配置监控告警
- 启动运营支持
- 持续收集用户反馈并迭代

### （二）关键里程碑

1. **第2周末**：接口文档、数据库表结构、前端原型图定稿
2. **第6周末**：后端基础接口、前端基础页面开发完成，实现登录与任务列表展示
3. **第9周末**：核心功能全流程打通，实现任务发布-接取-结算全链路
4. **第11周末**：测试验收通过，无重大Bug，性能达标
5. **第12周末**：正式上线，系统稳定运行

## 五、风险防控与应急预案

### （一）技术风险

#### 风险1：支付回调异常、资金结算错误
**预案**：
- 严格校验收钱吧回调签名与订单信息（金额、订单号一致性）
- 对接收钱吧订单查询接口做二次校验
- 结算逻辑加入事务控制，异常时自动回滚并触发告警
- 人工介入通过收钱吧后台核对交易数据

#### 风险2：高并发场景下接口响应缓慢
**预案**：
- 优化Redis缓存策略
- 接口加锁防止并发问题
- Nginx配置负载均衡
- 扩容服务器资源

#### 风险3：用户数据泄露
**预案**：
- 敏感数据加密存储
- 接口采用HTTPS
- 限制数据库访问权限
- 定期进行安全审计

### （二）业务风险

#### 风险1：恶意刷号、自发布自接取
**预案**：
- 强化风控模块，IP+设备+账号三重校验
- 异常交易自动预警
- 核实后冻结账户

#### 风险2：验收争议频发
**预案**：
- 完善申诉机制
- 平台仲裁时提取完整交易日志与交付凭证
- 明确判定标准
- 优化前端验收流程，引导用户规范提交整改意见

#### 风险3：第三方支付接口故障
**预案**：
- 依赖收钱吧多渠道能力，某一支付渠道（如微信）故障时，自动切换至其他渠道（如支付宝）
- 对接收钱吧健康检测接口，实时监控服务状态
- 故障时触发告警并切换至收钱吧备用接口，通知技术团队排查

## 六、扩展性规划

### 1. 功能扩展
预留任务分类标签、用户认证（实名认证）、技能标签匹配等接口，后续可新增"技能集市""优质任务推荐"功能。

### 2. 技术扩展
后端服务支持微服务拆分（后续可将支付、风控模块独立部署），前端支持小程序开发（微信/支付宝小程序，拓展用户场景）。

### 3. 生态扩展
预留第三方服务商接口，后续可接入兼职招聘、技能培训等生态伙伴，丰富平台功能。

## 七、具体实施建议

### 1. 团队配置
- **后端开发**：2人（负责Gin框架、支付对接、风控系统）
- **前端开发**：2人（负责Vue3.5界面、支付集成、状态管理）
- **测试工程师**：1人（负责功能测试、性能测试、安全测试）
- **运维工程师**：1人（负责部署、监控、安全防护）
- **产品经理**：1人（负责需求管理、用户反馈、迭代规划）

### 2. 技术重点
- **支付安全**：严格遵循收钱吧安全规范，确保资金安全
- **数据一致性**：采用分布式事务，确保交易数据一致性
- **用户体验**：简化操作流程，提升用户转化率
- **性能优化**：合理使用缓存，确保高并发场景下的系统稳定性

### 3. 质量保证
- **代码审查**：所有代码必须经过同行评审
- **自动化测试**：单元测试覆盖率不低于80%
- **安全测试**：定期进行渗透测试和安全评估
- **性能监控**：实时监控系统性能指标，及时发现问题

这份完整的规划方案涵盖了任务交易平台的技术选型、架构设计、开发实施、风险防控等各个方面，为项目的成功实施提供了全面的指导。
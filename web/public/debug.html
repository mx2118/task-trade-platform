<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•é¡µé¢ - æ£€æµ‹å‰ç«¯åŠ è½½é—®é¢˜</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .loading { background: #fff3cd; color: #856404; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; font-size: 14px; }
    </style>
</head>
<body>
    <h1>ğŸ” å‰ç«¯åŠ è½½è°ƒè¯•å·¥å…·</h1>
    
    <div id="status"></div>
    
    <h2>æ£€æµ‹é¡¹ç›®</h2>
    <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
    <button onclick="testVite()">æµ‹è¯•Vite</button>
    <button onclick="testAPI()">æµ‹è¯•API</button>
    <button onclick="testVue()">æµ‹è¯•Vueæ¨¡å—</button>
    
    <h2>è¯¦ç»†æ—¥å¿—</h2>
    <pre id="log"></pre>

    <script>
        const statusDiv = document.getElementById('status');
        const logDiv = document.getElementById('log');
        
        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            logDiv.textContent += `[${time}] ${type.toUpperCase()}: ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function showStatus(message, type = 'info') {
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        async function testVite() {
            try {
                log('æµ‹è¯•Viteå¼€å‘æœåŠ¡å™¨...');
                showStatus('â³ æ­£åœ¨æµ‹è¯•ViteæœåŠ¡å™¨...', 'loading');
                
                const response = await fetch('/');
                const html = await response.text();
                
                if (html.includes('vite') && html.includes('script')) {
                    log('âœ“ ViteæœåŠ¡å™¨æ­£å¸¸');
                    showStatus('âœ“ ViteæœåŠ¡å™¨æ­£å¸¸', 'success');
                    return true;
                } else {
                    log('âœ— HTMLå†…å®¹å¼‚å¸¸', 'error');
                    showStatus('âœ— HTMLå†…å®¹å¼‚å¸¸', 'error');
                    return false;
                }
            } catch (error) {
                log(`âœ— Viteæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showStatus(`âœ— Viteæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }

        async function testAPI() {
            try {
                log('æµ‹è¯•åç«¯API...');
                showStatus('â³ æ­£åœ¨æµ‹è¯•åç«¯API...', 'loading');
                
                const response = await fetch('http://49.234.39.189:8080/api/tasks?page=1&limit=1');
                const data = await response.json();
                
                if (data.code === 200) {
                    log(`âœ“ APIæ­£å¸¸ï¼Œä»»åŠ¡æ€»æ•°: ${data.data.total}`);
                    showStatus(`âœ“ APIæ­£å¸¸ï¼Œä»»åŠ¡æ€»æ•°: ${data.data.total}`, 'success');
                    return true;
                } else {
                    log(`âœ— APIè¿”å›é”™è¯¯: ${data.message}`, 'error');
                    showStatus(`âœ— APIè¿”å›é”™è¯¯`, 'error');
                    return false;
                }
            } catch (error) {
                log(`âœ— APIæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showStatus(`âœ— APIæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }

        async function testVue() {
            try {
                log('æµ‹è¯•Vueæ¨¡å—åŠ è½½...');
                showStatus('â³ æ­£åœ¨æµ‹è¯•Vueæ¨¡å—...', 'loading');
                
                // æµ‹è¯•ä¸»è¦çš„JSæ–‡ä»¶æ˜¯å¦èƒ½åŠ è½½
                const response = await fetch('/src/main.ts');
                const content = await response.text();
                
                if (content.includes('createApp') && content.includes('mount')) {
                    log('âœ“ main.ts åŠ è½½æ­£å¸¸');
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯
                    if (content.includes('Promise.race') || content.includes('async')) {
                        log('âœ“ å‘ç°å¼‚æ­¥ä»£ç ï¼Œè¿™å¯èƒ½å¯¼è‡´åŠ è½½å»¶è¿Ÿ');
                    }
                    
                    showStatus('âœ“ Vueæ¨¡å—åŠ è½½æ­£å¸¸', 'success');
                    return true;
                } else {
                    log('âœ— main.ts å†…å®¹å¼‚å¸¸', 'error');
                    showStatus('âœ— main.ts å†…å®¹å¼‚å¸¸', 'error');
                    return false;
                }
            } catch (error) {
                log(`âœ— Vueæ¨¡å—æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showStatus(`âœ— Vueæ¨¡å—æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }

        async function checkBrowserConsole() {
            log('æç¤ºï¼šè¯·æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°(F12)æŸ¥çœ‹æ›´å¤šé”™è¯¯ä¿¡æ¯');
            log('å¸¸è§é—®é¢˜:');
            log('1. CORSè·¨åŸŸé”™è¯¯');
            log('2. æ¨¡å—åŠ è½½å¤±è´¥');  
            log('3. APIè¯·æ±‚è¶…æ—¶');
            log('4. JavaScriptè¯­æ³•é”™è¯¯');
        }

        async function runAllTests() {
            log('====== å¼€å§‹å…¨é¢æµ‹è¯• ======');
            showStatus('â³ æ­£åœ¨è¿è¡Œæµ‹è¯•...', 'loading');
            
            const results = {
                vite: await testVite(),
                api: await testAPI(),
                vue: await testVue()
            };
            
            await checkBrowserConsole();
            
            const allPassed = Object.values(results).every(r => r);
            
            if (allPassed) {
                log('====== æ‰€æœ‰æµ‹è¯•é€šè¿‡ ======');
                showStatus('âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼å¦‚æœé¡µé¢è¿˜æ˜¯åŠ è½½ä¸­ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°', 'success');
            } else {
                log('====== éƒ¨åˆ†æµ‹è¯•å¤±è´¥ ======', 'error');
                showStatus('âœ— éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æ—¥å¿—', 'error');
            }
            
            log('\nå»ºè®®æ“ä½œ:');
            log('1. æ‰“å¼€ http://49.234.39.189:3000/layout/tasks');
            log('2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·');
            log('3. åˆ‡æ¢åˆ° Console æ ‡ç­¾');
            log('4. æŸ¥çœ‹çº¢è‰²é”™è¯¯ä¿¡æ¯');
            log('5. åˆ‡æ¢åˆ° Network æ ‡ç­¾');
            log('6. æŸ¥çœ‹å“ªä¸ªè¯·æ±‚å¤±è´¥æˆ–pending');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = () => {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡å¼€å§‹æµ‹è¯•...');
            setTimeout(runAllTests, 500);
        };
    </script>
</body>
</html>
